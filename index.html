<!DOCTYPE html>
<html>
<head>
    <title>Blog</title>
</head>
<body>
    <div id="new_entry">
        <textarea id="input_content"></textarea>
        <br>
        <input id="input_password" type="password">
        <input id="entry_submission" type="button">
        <br>
        <div id="submission_status">
    </div>

    <div id="feed">
    </div>

    <script type="text/javascript">

        window.onload = getEntries;

        document.getElementById('entry_submission').onclick = putEntry;

        function getEntries() {
            // TODO Implement with server
            const request = new XMLHttpRequest();
            request.open("GET", window.location + "/entries");

            // TODO Implement "onload" that will parse the JSON array
            const dateText = "Date for entry " + oldestEntryId;
            const content = "Content for entry " + oldestEntryId;

            var entry = generateEntry(dateText, content);
            document.getElementById('feed').append(entry);
        };

        function generateEntry(dateText, content) {
            var header = document.createElement('h2');
            header.innerHTML = dateText;
            var entry = document.createElement('div');
            entry.append(header);
            entry.append(content);
            return entry;
        };

        function putEntry() {
            // TODO Implement with server
            const request = new XMLHttpRequest();
            request.open("POST", window.location);
            console.log(document.getElementById('input_content').value);
            // TODO Make it promise-based
            request.send(JSON.stringify({
                content: document.getElementById('input_content').value,
                password: document.getElementById('input_password').value
            }));
            if (document.getElementById('input_password').value === '12345') {
                loadNewerEntry();
                document.getElementById('submission_status').innerHTML = "";
            } else {
                document.getElementById('submission_status').innerHTML = "Wrong password";
            }
            getEntries();
        };
    </script>
</body>
</html>
